trigger:
- main

pool:
  name: Default  # 👈 Ton agent auto-hébergé local

variables:
  IMAGE_NAME: xpensifyacr.azurecr.io/xpensify-auth-api
  TAG: v1

steps:
  - script: |
      echo "📦 Build de l'image Docker : $(IMAGE_NAME):$(TAG)"
      docker build -t $(IMAGE_NAME):$(TAG) .
    displayName: "🐳 Build Docker image"

  - script: |
      echo "🔐 Connexion à Azure Container Registry"
      echo "$REGISTRY_PASSWORD" | docker login xpensifyacr.azurecr.io -u xpensifyacr --password-stdin
    displayName: "🔐 Docker Login"
    env:
      REGISTRY_PASSWORD: $(REGISTRY_PASSWORD)

  - script: |
      echo "🚀 Push de l'image vers ACR"
      docker push $(IMAGE_NAME):$(TAG)
    displayName: "🚀 Push Docker image"