trigger:
- main

pool:
  name: Default  # ğŸ‘ˆ Ton agent auto-hÃ©bergÃ© local

variables:
  IMAGE_NAME: xpensifyacr.azurecr.io/xpensify-auth-api
  TAG: v1

steps:
  - script: |
      echo "ğŸ“¦ Build de l'image Docker : $(IMAGE_NAME):$(TAG)"
      docker build -t $(IMAGE_NAME):$(TAG) .
    displayName: "ğŸ³ Build Docker image"

  - script: |
      echo "ğŸ” Connexion Ã  Azure Container Registry"
      echo "$REGISTRY_PASSWORD" | docker login xpensifyacr.azurecr.io -u xpensifyacr --password-stdin
    displayName: "ğŸ” Docker Login"
    env:
      REGISTRY_PASSWORD: $(REGISTRY_PASSWORD)

  - script: |
      echo "ğŸš€ Push de l'image vers ACR"
      docker push $(IMAGE_NAME):$(TAG)
    displayName: "ğŸš€ Push Docker image"